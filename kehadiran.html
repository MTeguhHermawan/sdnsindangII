<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kehadiran Siswa</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
}
header {
  background:#1e88e5;
  color:white;
  padding:20px;
  text-align:center;
}
.container {
  padding:20px;
}
input, button {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
}
button {
  background:#1e88e5;
  color:white;
  border:none;
  font-size:16px;
}
.card {
  background:white;
  padding:15px;
  margin-top:15px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.05);
}
.tanggal {
  font-size:14px;
  color:#555;
}
.status {
  font-weight:bold;
}
</style>
</head>

<body>

<header>
  <h2>üìÖ Cek Kehadiran Siswa</h2>
  <a href="index.html" style="color:white">‚Üê Kembali</a>
</header>

<div class="container">
  <input id="kode" placeholder="Masukkan Kode Orang Tua">
  <button onclick="cek()">Lihat Kehadiran</button>
  <div id="hasil"></div>
</div>

<script>
function parseTanggal(tgl) {
  const p = tgl.split("/").map(Number);
  let d, m, y;

  // Deteksi format otomatis
  if (p[0] > 12) {
    // DD/MM/YYYY
    d = p[0]; m = p[1]; y = p[2];
  } else {
    // MM/DD/YYYY
    m = p[0]; d = p[1]; y = p[2];
  }

  return new Date(y, m - 1, d);
}

async function cek() {
  const kode = document.getElementById("kode").value.trim();
  const hasil = document.getElementById("hasil");
  hasil.innerHTML = "";

  try {
    const res = await fetch("data/kehadiran.csv");
    const text = await res.text();

    let data = [];
    const rows = text.split("\n").slice(1);

    rows.forEach(r => {
      if (!r.trim()) return;

      const kolom = r.split(",").map(x => x.trim());
      if (kolom.length < 4) return;

      const [k, nama, tanggal, status] = kolom;

      if (k === kode) {
        data.push({
          nama,
          tanggal,
          status,
          dateObj: parseTanggal(tanggal)
        });
      }
    });

    if (data.length === 0) {
      hasil.innerHTML = "<p>Data tidak ditemukan</p>";
      return;
    }

    // URUTKAN TERBARU ‚Üí TERLAMA
    data.sort((a, b) => b.dateObj - a.dateObj);

    // TAMPILKAN NAMA
    hasil.innerHTML += `
      <div class="card">
        <b>${data[0].nama}</b>
      </div>
    `;

    // TAMPILKAN DATA
    data.forEach(d => {
      hasil.innerHTML += `
        <div class="card">
          <div class="tanggal">${d.tanggal}</div>
          <div class="status">${d.status}</div>
        </div>
      `;
    });

  } catch (e) {
    hasil.innerHTML = "<p>Gagal membaca data</p>";
    console.error(e);
  }
}
</script>

</body>
</html>
