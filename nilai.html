<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Nilai Siswa</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0 }
header { background:#1e88e5; color:white; padding:20px; text-align:center }
.container { padding:20px }
input, select, button {
  width:100%; padding:12px; margin-top:10px;
  border-radius:8px; border:1px solid #ccc;
  font-size:16px;
}
button { background:#1e88e5; color:white; border:none }
.card {
  background:white;
  padding:15px;
  margin-top:12px;
  border-radius:10px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1)
}
</style>
</head>

<body>

<header>
<h2>üìä Cek Nilai Siswa</h2>
<a href="index.html" style="color:white;text-decoration:none">‚Üê Kembali</a>
</header>

<div class="container">
  <input id="kode" placeholder="Masukkan Kode Orang Tua">

  <select id="mapel">
    <option value="">-- Pilih Mata Pelajaran --</option>
    <option value="MATEMATIKA">Matematika</option>
    <option value="IPAS">IPAS</option>
    <option value="SBDP">SBDP</option>
    <option value="PKN">PKN</option>
    <option value="BAHASA SUNDA">Bahasa Sunda</option>
    <option value="BAHASA INGGRIS">Bahasa Inggris</option>
  </select>

  <button onclick="cek()">Lihat Nilai</button>

  <div id="hasil"></div>
</div>

<script>
function parseTanggal(tgl) {
  const [d, m, y] = tgl.split("/");
  return new Date(`${y}-${m}-${d}`);
}

function normalisasiMapel(teks) {
  return teks
    .toLowerCase()
    .split("(")[0]
    .replace(/\s+/g, " ")
    .trim();
}

async function cek() {
  const kodeInput = document.getElementById("kode").value.trim();
  const mapelDipilih = normalisasiMapel(
    document.getElementById("mapel").value
  );
  const hasil = document.getElementById("hasil");

  try {
    const res = await fetch("data/nilai.csv");
    const text = await res.text();

    const rows = text.trim().split(/\r?\n/).slice(1);
    let data = [];

    rows.forEach(row => {
      if (!row) return;

      const delimiter = row.includes(";") ? ";" : ",";
      const cols = row.split(delimiter).map(c => c.trim());

      if (cols.length >= 5) {
        const kode = cols[0];
        const mapelCSV = cols[2];
        const tanggal = cols[3];
        const nilai = cols[4];

        if (
          kode === kodeInput &&
          normalisasiMapel(mapelCSV) === mapelDipilih
        ) {
          data.push({
            mapel: mapelCSV,
            tanggal,
            nilai,
            dateObj: parseTanggal(tanggal)
          });
        }
      }
    });

    // üî• URUTKAN TERBARU ‚Üí TERLAMA
    data.sort((a, b) => b.dateObj - a.dateObj);

    let output = "";
    data.forEach(d => {
      output += `
        <div class="card">
          <b>${d.mapel}</b><br>
          Tanggal: ${d.tanggal}<br>
          Nilai: ${d.nilai}
        </div>
      `;
    });

    hasil.innerHTML = output || "<p>Data tidak ditemukan</p>";

  } catch (e) {
    hasil.innerHTML = "<p>Gagal membaca data nilai</p>";
    console.error(e);
  }
}
</script>

</body>
</html>
